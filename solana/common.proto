syntax = "proto3";

package io.chainstream.v1.common;

message EventMetadata {
  string time = 1;
}

message Block {
  int64 timestamp = 1;
  string hash = 2;
  uint64 height = 3;
  uint64 slot = 4;
}

enum Status {
  STATUS_UNSPECIFIED = 0;
  STATUS_SUCCESS = 1;
  STATUS_FAILED = 2;
}

enum BundleSource {
  BUNDLE_SOURCE_UNSPECIFIED = 0;
  BUNDLE_SOURCE_JITO = 1;
  BUNDLE_SOURCE_FALSHBOT = 2;
}

enum BundleHeuristic {
  BUNDLE_HEURISTIC_UNSPECIFIED = 0;
  // Level 1: Strong proof - direct transfer to Jito tip account in the same transaction
  BUNDLE_HEURISTIC_TIP_IN_TX = 1;
  // Level 2: Strong association - use of jitodontfront sentinel account (Jito's anti-MEV / low-latency path)
  BUNDLE_HEURISTIC_JITODONTFRONT_SENTINEL = 2;
  // Level 3: Heuristic - tip is in the same slot and the signer is the same
  BUNDLE_HEURISTIC_NEARBY_TIP_SAME_SIGNER = 3;
  // Level 3: Heuristic - more complex MEV detection (e.g., sandwich cluster)
  BUNDLE_HEURISTIC_CLUSTERED_MEVCALLS = 4;
}

message BundleTransaction {
  BundleSource source = 1;

  BundleHeuristic heuristic = 2;

  uint32 tip_tx_index = 4;
  uint32 tip_inner_index = 5;

  string tip_account = 6;
}

message Transaction {
  uint64 fee = 1;
  string fee_payer = 2;
  uint32 index = 3;
  string signature = 4;
  string signer = 5;
  Status status = 6;

  repeated BundleTransaction bundles = 10;
}

message DApp {
  string program_address = 1;
  string inner_program_address = 2;
  Chain chain = 3;
}

message Instruction {
  uint32 index = 1;
  bool is_inner_instruction = 2;
  uint32 inner_instruction_index = 3;
  string type = 4;
}

enum Chain {
  CHAIN_UNSPECIFIED = 0;
  CHAIN_SOLANA = 1;
  CHAIN_ETHEREUM = 2;
  CHAIN_BSC = 3;
  CHAIN_BASE = 4;
  CHAIN_ALGEN = 5;
}
